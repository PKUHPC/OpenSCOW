---
sidebar_position: 6
title: 代理网关节点
---

# 代理网关节点

门户系统的[桌面](../desktop.md)和交互式作业功能是通过HTTP代理，将用户的流量代理到了运行桌面的登录节点或者运行计算作业的计算节点上来实现的。这要求SCOW所在的服务节点能够直连所有登录和计算节点。

![直连](./without-gateway.png)

但是，在多集群环境中，各个集群之间的网络可能不连通，SCOW所在的服务节点可能不能直连所有集群的登录和计算节点。

对于这种情况，您可以给集群配置代理网关节点。在有代理网关的情况下，SCOW将会把所有流量首先发给集群的代理网关节点。代理网关节点将会负责将流量进一步转发到具体的节点中去。

![通过代理网关节点](./with-gateway.png)

# 选择并配置代理网关节点

您需要在您的需要代理网关节点的集群中选择一个节点作为**代理网关节点**。这个节点必须能被SCOW直接访问，也能访问自己集群中的所有机器。

当您选择好了节点后，您需要在网关节点上安装nginx，并增加如下配置：

```
```

重启nginx。

```bash
sudo systemctl restart nginx
```

# 在SCOW集群配置文件中配置代理网关节点

对于所有需要代理网关节点的集群，您需要在集群配置文件中增加以下配置：

```yaml title="config/clusters/hpc01/config.yaml"
proxyGatewayUrl: {代理网关节点nginx监听地址}
```

重启SCOW即可生效。

注意，一旦修改了此配置，被修改了配置的集群在修改配置之间启动的交互式作业将会无法重新连接。

